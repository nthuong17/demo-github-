-- trigger thao tác thao thay đổi thông tin bảng
use Northwind
go  

-- inserted: chua nhung truong da insert:update vao bang
--deleted: chua nhung truowng da bi xoa  khoi bang 
create trigger insertCustomer on dbo.Customers
for insert,update
as
begin 
	--rollback tran-- HUY bo thay doi cap nhat bang
	print 'trigger'
end
go

CREATE TRIGGER check_customer_id
 ON Orders
FOR insert as 
BEGIN
    DECLARE CustomerID
    SELECT COUNT(*) INTO customer_count 
	FROM Customers 
	WHERE customer_id = NEW.customer_id;
    IF CustomerID = 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Invalid customer_id'
    END IF
END
go 

SELECT * FROM Customers


insert dbo.Customers
           ([CustomerID]
           ,[CompanyName]
           ,[ContactName]
           ,[ContactTitle]
           ,[Address]
           ,[City]
           ,[Region]
           ,[PostalCode]
           ,[Country]
           ,[Phone]
           ,[Fax])
     VALUES
           (N'ID',
		   N'HT',
		   N'123',
		   N'TITLE',
		   N'ADD',
		   N'CITY',
		   N'Region'
           ,N'PostalCode'
           ,N'Country'
           ,N'Phone'
           ,N'Fax'
		   )
GO
--------------------------------
--khong cho phep xoa thong tin cua customers co country laf mexico
create trigger UT_NotMexico
on dbo.Customers
for delete
as begin

end
go


cREATE TRIGGER trg_CheckDuplicate_ENO
ON Customers
AFTER INSERT, UPDATE
AS
BEGIN
  SET NOCOUNT ON;

  IF EXISTS (
    SELECT ENO
    FROM EMP
    GROUP BY ENO
    HAVING COUNT(ENO) > 1
  )
  BEGIN
    RAISERROR ('Duplicate ENO detected. Rollback transaction.', 16, 1)
    ROLLBACK TRANSACTION;
    RETURN;
  END
END
go